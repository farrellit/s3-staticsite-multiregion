AWSTemplateFormatVersion: '2010-09-09'

Outputs:
  DestinationS3BucketArn:
    Description: "Full S3 Bucket Arn"
    Value: !Join [ "", [ 'arn:aws:s3:::' , !Ref DestinationReplicationBucket ] ]
Resources:
  DestinationReplicationBucket:
    Type: AWS::S3::Bucket
    DeletionPolicy: Retain
    Properties:
      VersioningConfiguration:
        Status: Enabled

  DestinationHealthCheck:
    Type: "AWS::Route53::HealthCheck"
    Properties:
      HealthCheckConfig:
        FullyQualifiedDomainName: !Join [ '.', [ !Join [ '-', [ "s3", !Ref "AWS::Region" ] ], "amazonaws.com" ] ]
        Type: "HTTPS"
        ResourcePath: !Join [ '/', [ '', !Ref 'DestinationReplicationBucket', 'index.html' ] ]
      HealthCheckTags:
        - Key: "Name"
          Value: "DestinationBucketHealthCheck"

  DestinationHealthCheckSNS:
    Type: AWS::SNS::Topic

  DestinationHealthCheckFailedAlarm:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ActionsEnabled: 'true'
      AlarmActions: [ !Ref DestinationHealthCheckSNS ]
      AlarmDescription: alarmed when status doesn't respond
      ComparisonOperator: LessThanThreshold
      EvaluationPeriods: '1'
      MetricName: HealthCheckStatus
      Namespace: AWS/Route53
      Period: '60'
      Statistic: Minimum
      Threshold: '1.0'
      Dimensions:
      - Name: HealthCheckId
        Value: !Ref DestinationHealthCheck


#  myDistribution:
#    Type: AWS::CloudFront::Distribution
#    Properties:
#      DistributionConfig:
#        Origins:
#        - DomainName: mybucket.s3.amazonaws.com
#          Id: myS3Origin
#          S3OriginConfig:
#            OriginAccessIdentity: origin-access-identity/cloudfront/E127EXAMPLE51Z
#        Enabled: 'true'
#        Comment: Some comment
#        DefaultRootObject: index.html
#        Logging:
#          IncludeCookies: 'false'
#          Bucket: mylogs.s3.amazonaws.com
#          Prefix: myprefix
#        Aliases:
#        - mysite.example.com
#        - yoursite.example.com
#        DefaultCacheBehavior:
#          AllowedMethods:
#          - DELETE
#          - GET
#          - HEAD
#          - OPTIONS
#          - PATCH
#          - POST
#          - PUT
#          TargetOriginId: myS3Origin
#          ForwardedValues:
#            QueryString: 'false'
#            Cookies:
#              Forward: none
#          TrustedSigners:
#          - 1234567890EX
#          - 1234567891EX
#          ViewerProtocolPolicy: allow-all
#        PriceClass: PriceClass_200
#        Restrictions:
#          GeoRestriction:
#            RestrictionType: whitelist
#            Locations:
#            - AQ
#            - CV
#        ViewerCertificate:
#          CloudFrontDefaultCertificate: 'true'
